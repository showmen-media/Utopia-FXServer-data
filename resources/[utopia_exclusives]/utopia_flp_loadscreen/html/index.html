<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>&gt; Flappy Ψυχικό &lt;</title>
	<meta name="viewport" content="width=600px, user-scalable=no">
    <script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
    <script src="jquery-collision.min.js"></script>
    <script>
        var MTimer;
        var obs = ['aOb', 'bOb', 'cOb'];
		var playing = false;
		var jump = 0, fivemProgress = 0;

        function loggg(val) {
            var line = document.createElement("div");
            line.appendChild(document.createTextNode(val));
            document.body.prepend(line);
        }

        function setProgress(x) {
            fivemProgress = x;
            getEle('txt').innerText = (
                getEle('txt').innerText
                    .replace(/\s+\(.*?\)$/, "")
                + " ("
                + (x * 100).toFixed(1)
                + "%)"
            );
            // if (x > .95 && !document.body.style.opacity)
            //     document.body.style.opacity = 0;
            // else if (x < .95)
            //     document.body.style.opacity = "";
        
            return (x * 100).toFixed(1);
        }

        var fivemHandlers = {
            startInitFunctionOrder(data) {
                count = data.count;
            },

            initFunctionInvoking(data) {
                setProgress(data.idx / count);
            },

            startDataFileEntries(data) {
                count = data.count;
            },

            performMapLoadFunction(data) {
                ++thisCount;
                setProgress(thisCount / count);
            }
        };

        window.addEventListener('message', function (e) {
            (fivemHandlers[e.data.eventName] || function () { })(e.data);
        });
		
        function getEle(id_) { return document.getElementById(id_);}
        function start() {
			jump = 65;
            MTimer = setInterval(move, 30);
            for (var i = 0; i < obs.length; i++) {
                var x = (390 * (i + 1) + 600) + 'px';
                getEle(obs[i] + 'U').style.left = x;
                getEle(obs[i] + 'D').style.left = x;
                var y = Math.floor((Math.random() * 500) + 100);
                getEle(obs[i] + 'U').style.height = y + 'px';
                getEle(obs[i] + 'D').style.top = (y + 200) + 'px';
                getEle(obs[i] + 'D').style.height = (800 - y) + 'px';
            }
            getEle('player').style.top = '350px';
            getEle('txt').innerText = (
                'Press any key to JUMP! ('
                + (fivemProgress * 100).toFixed(1)
                + "%)"
            );
            playing = true;
        }
        function btnP() {
			if (playing==true){jump = jump + 65;}
			else{start();}
        }
        function move() {
            for (var i = 0; i < obs.length; i++) {
                if (parseInt(getEle(obs[i]+'U').style.left.replace('px', '')) > -130) {
                    var x = parseInt(getEle(obs[i]+'U').style.left.replace('px', '')) - 3;
                    getEle(obs[i] + 'U').style.left = x + 'px';
                    getEle(obs[i] + 'D').style.left = x + 'px';
                }
                else {
                    var magic = 1 - fivemProgress;
                    getEle(obs[i] + 'U').style.left = '1030px';
                    getEle(obs[i] + 'D').style.left = '1030px';
                    var y = Math.floor((Math.random() * 500) + 100);
                    getEle(obs[i] + 'U').style.height = (y * magic) + 'px';
                    magic = ((600 - y) * magic);
                    getEle(obs[i] + 'D').style.height = magic + 'px';
                    getEle(obs[i] + 'D').style.top = (800 - magic) + 'px';
                };
            }
			if (jump<=0){
                getEle('player').style.top = (parseInt(getEle('player').style.top.replace('px', '')) + 3) + 'px';
			}
			else{
                getEle('player').style.top = (parseInt(getEle('player').style.top.replace('px', '')) - 3) + 'px';
                jump = jump - 3;
                    if (jump<=0){jump = 0;}
			}
            if ($("#player").collision(".obs").length > 0) { crash(); };
            if (parseInt(getEle('player').style.top.replace('px', '')) >= 700) { crash(); };
        }
        function crash() {
            clearInterval(MTimer);
            getEle('txt').innerText = (
                'Press any key to restart ('
                + (fivemProgress * 100).toFixed(1)
                + "%)"
            );
			playing = false;
        }
    </script>
    <style type="text/css">
        html {background: black;}
        body {background: black url("highschool.jpg") no-repeat center/cover; height: 100vh; width: 100vw; min-height: 100%; min-width: 100%; overflow:hidden; font-family: Arial, Helvetica, sans-serif; transition: opacity 1s ease;margin: 0;}
        #game {height: 800px; width: 600px;position: absolute;top:50%;left:50%;transform:translate(-50%, -50%);}
        #player {border: 3px groove red; height: 75px; width:75px; border-radius: 5%;position: absolute;background:url(ba.jpg) no-repeat;background-size:75px;left:225px;border-radius: 50%;}
        #txt {position: fixed; top: 10px; right: 5%; left: 5%; height: 100px; width: 90%; font-size: 24px; color: white; text-align: center;}
        .obs {background: green; border: 1px dotted black;height: 800px;position: absolute;top:0px;left: 600px; width: 130px;}
    </style>
</head>
<body onkeydown="btnP()" onclick="btnP()">
    <div id="game">
        <div id="player" style="top:350px;"></div>
        <div id="aObU" class="obs"></div>
        <div id="aObD" class="obs"></div>
        <div id="bObU" class="obs"></div>
        <div id="bObD" class="obs"></div>
        <div id="cObU" class="obs"></div>
        <div id="cObD" class="obs"></div>
		<div id="txt">Press any key to Start!</div>
        <!--<button id="bt1" onclick="btnP()">Start</button>
        <button onclick="crash()">Crash</button>-->
    </div>
</body>
</html>
